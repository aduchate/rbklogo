"use strict";function makeMarker(){var a=document.createElement("div");return a.style.color="#822",a.style.marginLeft="-23px",a.style.fontSize="18px",a.style.bottom="-5px",a.innerHTML="‚óè",a}function loadLogo(a){var b=$("#storage").find("input");storage.load(a?a:b.val()).then(function(a){logoCode.setValue(a.data),b.val(a._id)})}function saveLogo(){storage.save($("#storage").find("input").val(),logoCode.getValue(),!0).then(function(){$("#consoleText").text(""+name+" saved"),setTimeout(function(){$("#consoleText").text("")},5e3),refreshLogoList()})}function delLogo(){UIkit.modal.confirm("Are you sure you wish to delete "+$("#storage").find("input").val()+"?",function(){var a=$("#storage").find("input");storage["delete"](a.val()),a.val("")})}function refreshLogoList(){storage.list(function(a){var b=$("#logoList");b.empty(),a.forEach(function(a){b.append("<li><a onclick=\"loadLogo('"+a+"')\">"+a+"</a></li>")})})}"undefined"!=typeof CodeMirror&&(CodeMirror.defineMode("logo",function(){var a=/^(\.?[A-Za-z\u00A1-\u1FFF][A-Za-z0-9_.\?\u00A1-\u1FFF]*|[\u2190-\u2193])/,b=/^["'][^ \[\]\(\)\{\}]*/,c=/^:[A-Za-z\u00A1-\u1FFF][A-Za-z0-9_\u00A1-\u1FFF]*/,d=/^[0-9]*\.?[0-9]+(?:[eE]\s*[\-+]?\s*[0-9]+)?/,e=/^\+|\-|\*|\/|%|\^|>=|<=|<>|=|<|>|\[|\]|\{|\}(\s*@\s*\d+)?|\(|\)/;return{electricChars:"[]dD",startState:function(){return{state:"normal",indent:0}},indent:function(a,b){var c=2,d=a.indent;switch(/^\]/.test(b)&&--d,a.state){case"defn-name":return(d+1)*c;case"defn-vars":case"defn-body":return/^END\b/i.test(b)?d*c:(d+1)*c;default:return d*c}},token:function(f,g){if(f.eatSpace())return null;if(f.match(/^;.*/,!0))return"logo-comment";if("normal"===g.state){if(f.match(/^TO\b/i,!0))return g.state="defn-name","logo-defn-start";if(f.match(/^END\b/i,!0))return"logo-error"}if("defn-name"===g.state)return f.match(a,!0)?(g.state="defn-vars","logo-defn-name"):(f.next(),g.state="normal","logo-error");if("defn-vars"===g.state){if(f.match(c,!0))return"logo-defn-arg";g.state="defn-body"}if("defn-body"===g.state&&f.match(/^END\b/i,!0))return g.state="normal","logo-defn-end";if("normal"===g.state||"defn-body"===g.state)return f.match(d,!0)?"logo-number":f.match(b,!0)?"logo-string":f.match(/^\[/,!0)?(++g.indent,"logo-operator"):f.match(/^\]/,!0)?(g.indent>0&&--g.indent,"logo-operator"):f.match(e,!0)?"logo-operator":f.match(c,!0)?"logo-variable":f.match(/^(TRUE|FALSE)\b/i,!0)?"logo-keyword":f.match(a,!0)?"logo-word":(f.next(),"logo-error");throw"WTF?"}}}),CodeMirror.defineMIME("text/x-logo","logo"));var logo,logoCode=CodeMirror(document.querySelectorAll(".code #placeholder")[0],{mode:"logo",lineNumbers:!0,gutters:["CodeMirror-linenumbers","breakpoints"]});logoCode.on("gutterClick",function(a,b){var c=a.lineInfo(b);c.gutterMarkers?delete logo.breakPoints[c.line]:logo.breakPoints[c.line+1]=1,a.setGutterMarker(b,"breakpoints",c.gutterMarkers?null:makeMarker())}),logo={canvas:null,ctx:null,aborted:!1,paused:!1,running:!1,delay:100,breakPoints:{},turtle:{ctx:null,x:300,y:300,direction:0,pen:!0,linecolor:"#ff6666",show:function(){$("#turtle").css({visibility:"inherit"})},hide:function(){$("#turtle").css({visibility:"hidden"})},drawLine:function(){this.pen?this.ctx.lineTo(this.x,this.y):this.ctx.moveTo(this.x,this.y),this.ctx.stroke()},fw:function(a){var b=3.1415926359*(90-this.direction)/180;this.x+=Math.cos(b)*a,this.y-=Math.sin(b)*a,this.drawLine(),logo.sync()},lt:function(a){this.direction-=a,logo.sync()},set:function(a,b){this.x=a,this.y=b,this.drawLine(),logo.sync()},home:function(){this.set(300,300),this.direction=0,logo.sync()}},setDelay:function(a){this.delay=a},bind:function(){this.canvas=$("canvas")[0],this.ctx=this.canvas.getContext("2d"),this.turtle.ctx=this.ctx},clear:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},sync:function(){$("#turtle").css({top:""+(this.turtle.y-12)+"px",left:""+(this.turtle.x-10)+"px",transform:"rotate("+this.turtle.direction+"deg)"})},play:function(){var a=$("#play");if(logo.paused)return logo.paused=!1,void a.find("i").removeClass("fa-play").removeClass("fa-play-circle").addClass("fa-pause");if(logo.running)return void this.pause();try{$("#consoleText").text(""),a.find("i").removeClass("fa-play").addClass("fa-pause"),this.aborted=!1,this.paused=!1,this.running=!0,this.ctx.beginPath(),this.ctx.moveTo(this.turtle.x,this.turtle.y),this.ctx.strokeStyle=this.turtle.linecolor,this.ctx.lineWidth=1;var b=this;LogoParser.parse(logoCode.getValue(),{tracer:{trace:function(a){}}})().then(function(){b.ctx.stroke(),b.stop()})}catch(c){if(!c.name||"SyntaxError"!==c.name)throw console.log(c),c;$("#consoleText").text(c.message+" ["+c.location.start.line+":"+c.location.start.column+"]")}},pause:function(){var a=$("#play");logo.paused=!0,a.find("i").removeClass("fa-pause").addClass("fa-play-circle")},stop:function(){var a=$("#play");this.aborted=!0,this.paused=!1,this.running=!1,a.find("i").removeClass("fa-play-circle").removeClass("fa-play").removeClass("fa-pause").addClass("fa-play")}};var storage={db:function(){return this._db?this._db:this._db=new PouchDB("turtles")},save:function(a,b,c){var d=this;d.load(a).then(function(a){return c?(a.data=b,d.db().put(a)):void 0})["catch"](function(){return d.db().put({_id:a,data:b})})},load:function(a){return this.db().get(a)},"delete":function(a){var b=this;b.load(a).then(function(a){return b.db().remove(a)})},list:function(a){this.db().allDocs().then(function(b){a(b.rows.map(function(a){return a.id}))})}};storage.save("Ex-Spirale","to spiral :length\r  if :length > 10 [\r	av :length\r	gauche 90\r	spiral :length - 5\r  ]\rend\r\rspiral 100",!1),storage.save("Ex-Arbre","to arbre :length\r  ifelse :length > 10 [\r	gauche 40\r	avance :length\r    arbre :length - 25\r    recule :length\r	droite 30\r	avance :length\r    arbre :length - 15\r    recule :length\r    droite 60\r    avance :length\r    arbre :length - 15\r    recule :length\r    gauche 50\r  ] [\r    ga 30 av 5 dr 60 av 5 ga 60 re 5 dr 60 re 5 ga 30\r  ]\rend\r\rpu cs maison \rdr 45 re 80 ga 45\rpd\rrecule 200\ravance 200\rarbre 90\rgauche 20 arbre 85\rdroite 60 arbre 65",!1),storage.save("Ex-Carres","repete 36 [\n	repete 4 [\n		avance 100\n		gauche 90\n	]\n	gauche 10\n]",!1),logo.bind(),logo.sync(),logo.turtle.show(),function(a,b){UIkit.on("domready.uk.dom",function(){b.autocomplete(a(".uk-autocomplete"),{source:function(b){storage.list(function(c){var d=a("#storage").find("input").val().toLowerCase();b(c.filter(function(a){return a.toLowerCase().indexOf(d)>-1}).map(function(a){return{title:a,value:a,url:"#"}}))})}}),refreshLogoList(),a("#storage").find("input").val("Ex-Spiral"),logoCode.setValue("to spiral :length\r  if :length > 10 [\r	av :length\r	gauche 90\r	spiral :length - 5\r  ]\rend\r\rspiral 100")})}(jQuery,UIkit);